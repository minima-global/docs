---
title: Archive Management
description: Learn how to manage your archive node
tag: user-guides
---

## Export to an archive file

### .dat file export

From v1.0.39 onwards, a **.raw.dat** export can be used by users to recover their node via the Security minidapp or with the [reset](/docs/userguides/usingyournode/terminal_commands) command. This is the recommended method.

Optionally omit the `file` parameter to use an autogenerated file name. 

```bash title="Terminal"
mysql action:rawexport file:archiveexport.raw.dat host:minimysql database:archivedb user:archiveuser password:youruserpassword
```

### .gzip file export 

This .gzip export can be used by users to archive reset their node via the Security minidapp or with the [reset](/docs/userguides/usingyournode/terminal_commands#backup) command.

```bash title="Terminal"
mysql  action:h2export file:archiveexport.gzip host:minimysql database:archivedb user:archiveuser password:youruserpassword
```

## Resync from MySQL

If a user has been offline for too long and cannot resync to the chain from the IBD alone, or has lost access to their node, they can connect to a MySQL database to perform a chain or seed resync, provided it is publicly accessible.

This is an alternative option to re-syncing from an archive node.

As with archive nodes, there are two options when using a MySQL database to re-sync your a node:

- `Chain re-sync:` If a user has been offline for too long and their node is not on the correct tip block, they can re-sync to the latest block by performing a [chain re-sync](#to-perform-a-chain-re-sync) from a MySQL database. **The node will NOT be wiped during this process.**
- `Seed re-sync:` If a user does not have a valid backup or has lost access to their node, they can restore access to their coins by performing a [seed re-sync](#to-perform-a-seed-re-sync) from a MySQL database using their 24 word seed phrase. **The node will first be wiped before the re-sync begins.**

<Callout title="Info">
To re-sync using credentials for a read-only user,  set the `user` and `password` parameters as the credentials for the read-only user you have set up in MySQL, and add `readonly:true` as a parameter in the following commands.
</Callout>

### To perform a chain re-sync

1. On the node requiring a re-sync, check the connection to the MySQL database, changing the ip:port as required

```bash title="Terminal"
mysql host:127.0.0.1:3307 database:archivedb user:archiveuser password:youruserpassword action:info
```

2. To start the chain re-sync, run

```bash title="Terminal"
mysql host:mysqlhost:port database:archivedb user:archiveuser password:youruserpassword action:resync
```

Your coins will remain safe throughout this process. Once complete, you will be on the correct tip block.

### To perform a seed re-sync

1. On the node requiring a re-sync, connect to check the MySQL archive database

```bash title="Terminal"
mysql host:127.0.0.1:3307 database:archivedb user:archiveuser password:youruserpassword action:info
```

2. To start the seed re-sync, run

```bash title="Terminal"
mysql host:mysqlhost:port database:archivedb user:archiveuser password:youruserpassword action:resync phrase:\"24 WORDS HERE\"
```

Optionally set the number of keys and keyuses relevant to you. If not specified, the defaults are keys:80 and keyuses:1000

```bash title="Terminal"
mysql host:mysqlhost:port database:archivedb user:archiveuser password:youruserpassword action:resync phrase:\"24 WORDS HERE\" keys:90 keyuses:2000
```

## Check an address history

To check the unspent and spent coins for an address, run 

```bash title="Terminal"
mysql host:127.0.0.1:3307 database:archivedb user:archiveuser password:youruserpassword action:addresscheck address:0x79...
```

## Create a coins table

To create a table in your MySQL archive database for all spent and unspent coins, you can use the `mysqlcoins` command. 

The coins table will be populated from the syncblock table, so this must be populated first. You can then run any SQL command against it to query the coins. 

<Callout title="Info">
The coins database is large and will take a while to populate, optionally you can create a second database in mysql workbench to keep the coinsdb separate to your existing archivedb.
</Callout>

To populate the coins table, you can choose to specify the number of coins to update in one go by using the `maxcoins` parameter. To update the table will all the coins, remove the `maxcoins` parameter.

The example below adds the first 100 coins to the database. Next time, it will start from where it left off. 

**From any node**
```bash title="Terminal"
mysqlcoins action:update maxcoins:100 host:127.0.0.1:3307 database:archivedb user:archiveuser password:youruserpassword 
```

**From docker**
```bash title="Terminal"
mysqlcoins action:update maxcoins:100 host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

## Query the coins table

To search for all coins at an address or with the address in a state variable:

```bash title="Terminal"
mysqlcoins action:search address: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

To run a WHERE query on the coins table, string data MUST be in single quotes and you can use multiple parameters.

```bash title="Terminal"
mysqlcoins action:search where: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

To run a full SQL query on the coins table:

```bash title="Terminal"
mysqlcoins action:search query: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

For full help, use `help command:mysqlcoins` or see [here](/docs/userguides/usingyournode/terminal_commands).

## Export the tables from MySQL

To Export the archive data from MySQL to a file:

1. Open MySQL workbench

2. Double click on **minimaarchive** to open the database

3. From the **Administration** tab, select **Data Export** (also available from the Server dropdown menu)

![sql](/img/archivenode/F.AdminExportData.png) 

4. Check the box for **archivedb** and check the boxes for **cascadedata** and **syncblock** 

<Callout type="warn">
We do not recommend exporting the coins table as this will be very large.
</Callout>

5. Under Export Options, select **Export to self-contained file** and **Include Create Schema**. Optionally change the file path.

![sql](/img/archivenode/G.DataExportSelection.png) 

6. Click **Start Export**

The exported file will be unzipped, you should zip the exported file to reduce your storage requirement. 

This file can be imported to MySQL if required.
