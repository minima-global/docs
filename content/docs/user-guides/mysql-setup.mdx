---
title: MySQL Storage
description: Learn how to integration Minima with MySQL
tag: user-guides
---

Minima data can be exported to an external MySQL database for storage and efficient querying.

The following data can be exported to a table in a SQL database:

1. cascadedata - if the node does not start at the genesis block, there will be compact block data for the cascade
2. syncblocks - historical compact blocks (excludes transaction details)
3. coins (from v1.0.39) - a coins table of all coins in the syncblocks
4. txpows (from v1.0.41) - full txpow data, including full transaction and block details

{/* Exporting your node's chain data to MySQL means you can:

- update the MySQL db with the archive blocks from your node
- chain or seed re-sync directly from the MySQL database for any Minima node (if made publicly available)
- export the archive blocks from MySQL to a .dat or .gzip file to be shared for re-syncing purposes
- execute SQL queries on all coins since the Genesis block (NEW for v 1.0.39);
- export the tables from MySQL to a SQL file
- import the SQL file to another MySQL databaseThis setup uses two Docker containers */}

## MySQL Setup

<Tabs items={["MySQL Server","Docker"]}>
<Tab value="MySQL Server">

1. Install MySQL Workbench and MySQL Server from the [official website](https://dev.mysql.com/downloads/installer/), selecting the Operating System relevant to you


</Tab>
<Tab value="Docker">


1. Install MySQL Workbench from the [official website](https://dev.mysql.com/downloads/workbench/), selecting the Operating System relevant to you

2. Open your Terminal/Command Line interface

3. Setup a Docker network, this will allow you to connect your node to your MySQL database that we will create in the next step

```bash title="Terminal"
docker network create -d bridge minimanetwork
```

Now you should see **minimanetwork** listed if you run

```bash title="Terminal"
docker network ls
```

4. Start a MySQL database as a Docker container

You will need to set your own values for the following parameters:

- MYSQL_ROOT_PASSWORD : create a root password
- MYSQL_DATABASE : create a name for the archive database
- MYSQL_USER : create a user for the archive database
- MYSQL_PASSWORD : create a password for the MYSQL_USER

```bash title="Terminal"
docker run -d -p 3307:3306  -e MYSQL_ROOT_PASSWORD=yourrootpassword -e MYSQL_DATABASE=archivedb -e MYSQL_USER=archiveuser -e MYSQL_PASSWORD=youruserpassword --restart unless-stopped --network=minimanetwork --label=com.centurylinklabs.watchtower.enable=false --name minimysql mysql:8.0
```

This will create a Docker container called **minimySQL** which runs your MySQL database called **archivedb**.

It will run on your port 3307 (mapped to 3306 in Docker); create the user specified and give them access to the database; connect the MySQL db to the **minimanetwork** Docker network; and disable Watchtower updates for the container.

5. Connect your Minima archive node container to the **minimanetwork** Docker network

```bash title="Terminal"
docker network connect minimanetwork minimaarchive
```

Example output:

Example output:

```json title="Output"
[
    {
        "Name": "minimanetwork",
        "ConfigOnly": false,
        "Containers": {
            "182c4041ad365669b365ee6e0691e5488596ab1e974b791bba1306c74643bd03": {
                "Name": "minimaarchive"
            },
            "38906df591a5ba642e755509e8c162e114b6dd56abc2ec2e76a0c673f5187b09": {
                "Name": "minimysql"
            }
        }
    }
]
```

    - `Connection name:` minimaarchive
    - `**Hostname:` 127.0.0.1 (or your public IP if running on a server)
    - `Port:` 3307
    - `Username:` root
    - `Password:` Click on “Store in Vault” and enter the root password you used in step 4 above

![sql](/img/archivenode/A.AddConnection.png) 

![sql](/img/archivenode/B.CreateConnection.png) 


7. Click Test Connection, then OK.

This will setup a connection to the MySQL database running in Docker.

</Tab>
</Tabs>

## Update MySQL

To update the MySQL tables with the archive blocks from your node:

1. Open Minima Docker CLI or Minima Terminal MiniDapp

2. Optional - run the command `mysql action:info` with your login details to check the current status 

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:info
```

Example output:

```json title="Output"
{
  "command":"mysql",
  "params":{
    "host":"minimysql",
    "database":"archivedb",
    "user":"archiveuser",
    "password":"youruserpassword",
    "action":"info"
  },
  "status":true,
  "pending":false,
  "response":{
    "archive":{
      "archivestart":1,
      "archiveend":72106,
      "archivetotal":72105
    },
    "mysql":{
      "mysqlstart":-1,
      "mysqlend":-1,
      "mysqltotal":0
    }
  }
}
```

In the above example, the Minima archive db contains 72105 blocks and the mysql has 0 blocks, as expected.

<Callout type="warning">
Before running an update, you must check your node is on the correct tip block. Run the `status` command to check your tip block is up to date.
</Callout>

3. Update the MySQL database with the Minima archive data and wait for it to finish

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:update
```


Example output:

```json title="Output"
{
  "command":"mysql",
  "params":{
    "host":"minimysql",
    "database":"archivedb",
    "user":"archiveuser",
    "password":"youruserpassword",
    "action":"update"
  },
  "status":true,
  "pending":false,
  "response":{
    "archive":{
      "archivestart":1,
      "archiveend":72206,
      "archivetotal":72205
    },
    "mysql":{
      "mysqlstart":1,
      "mysqlend":72206,
      "mysqltotal":72205
    }
  }
}
```

Future updates will be incremental, only syncing the new blocks that are not already in the MySQL database.

### Auto update

To automatically update the MySQL database daily, run:

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:autobackup enable:true
```

## Check the integrity

To check that there are no missing blocks in the MySQL database, you can run:

```bash title="Terminal"
mysql action:integrity host:minimysql database:archivedb user:archiveuser password:youruserpassword
```
