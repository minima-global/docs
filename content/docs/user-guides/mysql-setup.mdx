---
title: Export data to MySQL
description: Learn how to integration Minima with MySQL
tag: user-guides
---

Minima data can be exported to an external MySQL database for storage and efficient querying.

The following data can be exported to a table in a SQL database:

| Table               | Description                                                              |
|--------------------|--------------------------------------------------------------------------|
| `cascadedata`      | if the node does not start at the genesis block, there will be compact block data for the cascade |
| `syncblocks`       | historical compact blocks (excludes transaction details)                 |
| `coins`            | (from v1.0.39) a coins table of all coins in the syncblocks            |
| `txpow`       | (from v1.0.41) full txpow data, including all transaction and block details |

{/* Exporting your node's chain data to MySQL means you can:

- update the MySQL db with the archive blocks from your node
- chain or seed re-sync directly from the MySQL database for any Minima node (if made publicly available)
- export the archive blocks from MySQL to a .dat or .gzip file to be shared for re-syncing purposes
- execute SQL queries on all coins since the Genesis block (NEW for v 1.0.39);
- export the tables from MySQL to a SQL file
- import the SQL file to another MySQL databaseThis setup uses two Docker containers */}

## MySQL Setup


<Tabs items={["MySQL Server","Docker"]}>
<Tab value="MySQL Server">

{/* <Steps>
<Step> */}

**1. Install MySQL Workbench and MySQL Server**

- Download the [MySQL Installer](https://dev.mysql.com/downloads/installer/) and select the appropriate version for your operating system.
- During the installation process, you can choose **Custom Installation** if you only need **MySQL Workbench** and **MySQL Server**.
- **Set a password for the root user** when prompted


<Callout type="tip" title="Windows Installation">
For Windows installations:
- If you don’t want to open firewall ports, **uncheck** the option to **"Open Windows Firewall ports for network access"**.
- To ensure MySQL Server starts with Windows, **check** the option to **"Start the MySQL Server at System Startup"**.
</Callout>

**2. Open MySQL Workbench and Create a Connection to Your MySQL Server**

- Open **MySQL Workbench**.
- In the **MySQL Connections** section, click **+** to create a new connection if one doesn’t already exist.

| Field             | Description                                                                                |
|------------------|--------------------------------------------------------------------------------------------|
| Connection name  | Enter a name (e.g., **Local Server**).                                                     |
| Hostname         | Use **127.0.0.1** if MySQL Server is on your local machine, or enter the server’s IP address if remote. |
| Port             | **3306** (unless configured otherwise during installation).                                |
| Username         | **root**                                                                                   |
| Password         | Click on **Store in Vault** and enter the root password set during installation.            |

- Click **Test Connection** to confirm the connection settings, then click **OK** to save the connection.


**3. Create a New Database**

- In **MySQL Workbench**, select your connection to open it.
- In the **Query** window, run the following command to create a new database named `minimaarchive`:
   ```sql
    CREATE DATABASE minimaarchive;
   ```


**4. Create users**

- Create another user e.g. archiveuser with all privileges 
- Optionally create additional users e.g. a read-only user if required.

Your database `minimaarchive` is now created and ready for use!


</Tab>
<Tab value="Docker">

**1. Install MySQL Workbench**

Install MySQL Workbench from the [official website](https://dev.mysql.com/downloads/workbench/) and select the appropriate version for your operating system.

**2. Setup a Docker network**

- Open your Terminal/Command Line interface
- Setup a Docker network, this will allow you to connect your node to your MySQL database that we will create in the next step

```bash title="Terminal"
docker network create -d bridge minimanetwork
```

Now you should see **minimanetwork** listed if you run

```bash title="Terminal"
docker network ls
```

**3. Start a MySQL database as a Docker container**

You will need to set your own values for the following parameters:

| Term                  | Description                                 |
|-----------------------|---------------------------------------------|
| `MYSQL_ROOT_PASSWORD` | create a root password                      |
| `MYSQL_DATABASE`      | create a name for the archive database      |
| `MYSQL_USER`          | create a user for the archive database      |
| `MYSQL_PASSWORD`      | create a password for the `MYSQL_USER`      |


```bash title="Terminal"
docker run -d -p 3307:3306  -e MYSQL_ROOT_PASSWORD=yourrootpassword -e MYSQL_DATABASE=archivedb -e MYSQL_USER=archiveuser -e MYSQL_PASSWORD=youruserpassword --restart unless-stopped --network=minimanetwork --label=com.centurylinklabs.watchtower.enable=false --name minimysql mysql:8.0
```

This will:
- create a Docker container called **minimySQL** which runs your MySQL database called **archivedb**
- run on your port 3307 (mapped to 3306 in Docker)
- create the user specified and give them access to the database
- connect the MySQL db to the **minimanetwork** Docker network
- disable Watchtower updates for the container

**4. Connect Minima to the minimanetwork**

```bash title="Terminal"
docker network connect minimanetwork minimaarchive
```

Example output:

```json title="Output"
[
    {
        "Name": "minimanetwork",
        "ConfigOnly": false,
        "Containers": {
            "182c4041ad365669b365ee6e0691e5488596ab1e974b791bba1306c74643bd03": {
                "Name": "minimaarchive"
            },
            "38906df591a5ba642e755509e8c162e114b6dd56abc2ec2e76a0c673f5187b09": {
                "Name": "minimysql"
            }
        }
    }
]
```

**5. Create a connection to the server**

In MySQL Workbench, create a connection to the server 

| Field             | Description                                                                                |
|------------------|--------------------------------------------------------------------------------------------|
| Connection name  | minimaarchive                                                    |
| Hostname         | Use **127.0.0.1** if Docker is on your local machine, or enter the server’s IP address if remote. |
| Port             | **3307**                             |
| Username         | **root**                                                                                   |
| Password         | Click on **Store in Vault** and enter the root password set during installation.            |


![sql](/img/archivenode/A.AddConnection.png) 

- Click Test Connection, then OK.

Your database `minimaarchive` is now created and ready for use!


</Tab>
</Tabs>



## Update MySQL

To update the MySQL tables with the archive blocks from your node:

1. Open Minima Docker CLI or Minima Terminal MiniDapp

2. Optional - run the command `mysql action:info` with your login details to check the current status 

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:info
```

Example output:

```json title="Output"
{
  "command":"mysql",
  "params":{
    "host":"minimysql",
    "database":"archivedb",
    "user":"archiveuser",
    "password":"youruserpassword",
    "action":"info"
  },
  "status":true,
  "pending":false,
  "response":{
    "archive":{
      "archivestart":1,
      "archiveend":72106,
      "archivetotal":72105
    },
    "mysql":{
      "mysqlstart":-1,
      "mysqlend":-1,
      "mysqltotal":0
    }
  }
}
```

In the above example, the Minima archive db contains 72105 blocks and the mysql has 0 blocks, as expected.

<Callout type="warning">
Before running an update, you must check your node is on the correct tip block. Run the `status` command to check your tip block is up to date.
</Callout>

3. Update the MySQL database with the Minima archive data and wait for it to finish

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:update
```


Example output:

```json title="Output"
{
  "command":"mysql",
  "params":{
    "host":"minimysql",
    "database":"archivedb",
    "user":"archiveuser",
    "password":"youruserpassword",
    "action":"update"
  },
  "status":true,
  "pending":false,
  "response":{
    "archive":{
      "archivestart":1,
      "archiveend":72206,
      "archivetotal":72205
    },
    "mysql":{
      "mysqlstart":1,
      "mysqlend":72206,
      "mysqltotal":72205
    }
  }
}
```

Future updates will be incremental, only syncing the new blocks that are not already in the MySQL database.

### Auto update

To automatically update the MySQL database daily, run:

```bash title="Terminal"
mysql host:minimysql database:archivedb user:archiveuser password:youruserpassword action:autobackup enable:true
```

## Check the integrity

To check that there are no missing blocks in the MySQL database, you can run:

```bash title="Terminal"
mysql action:integrity host:minimysql database:archivedb user:archiveuser password:youruserpassword
```


## Create a coins table

To create a table in your MySQL archive database for all spent and unspent coins, you can use the `mysqlcoins` command. 

The coins table will be populated from the syncblock table, so this must be populated first. You can then run any SQL command against it to query the coins. 

<Callout title="Info">
The coins database is large and will take a while to populate, optionally you can create a second database in mysql workbench to keep the coinsdb separate to your existing archivedb.
</Callout>

To populate the coins table, you can choose to specify the number of coins to update in one go by using the `maxcoins` parameter. To update the table will all the coins, remove the `maxcoins` parameter.

The example below adds the first 100 coins to the database. Next time, it will start from where it left off. 

**From any node**
```bash title="Terminal"
mysqlcoins action:update maxcoins:100 host:127.0.0.1:3307 database:archivedb user:archiveuser password:youruserpassword 
```

**From docker**
```bash title="Terminal"
mysqlcoins action:update maxcoins:100 host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

## Query the coins table

To search for all coins at an address or with the address in a state variable:

```bash title="Terminal"
mysqlcoins action:search address: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

To run a WHERE query on the coins table, string data MUST be in single quotes and you can use multiple parameters.

```bash title="Terminal"
mysqlcoins action:search where: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

To run a full SQL query on the coins table:

```bash title="Terminal"
mysqlcoins action:search query: host:minimysql database:archivedb user:archiveuser password:youruserpassword 
```

For full help, use `help command:mysqlcoins` or see [here](/docs/userguides/usingyournode/terminal_commands).

## Export the tables from MySQL

To Export the archive data from MySQL to a file:

1. Open MySQL workbench

2. Double click on **minimaarchive** to open the database

3. From the **Administration** tab, select **Data Export** (also available from the Server dropdown menu)

![sql](/img/archivenode/F.AdminExportData.png) 

4. Check the box for **archivedb** and check the boxes for **cascadedata** and **syncblock** 

<Callout type="warn">
We do not recommend exporting the coins table as this will be very large.
</Callout>

5. Under Export Options, select **Export to self-contained file** and **Include Create Schema**. Optionally change the file path.

![sql](/img/archivenode/G.DataExportSelection.png) 

6. Click **Start Export**

The exported file will be unzipped, you should zip the exported file to reduce your storage requirement. 

This file can be imported to MySQL if required.
